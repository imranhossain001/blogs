<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Wanna clone existing Arch Linux installation ? ::
        Imran Hossain
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="This also works to install Arch on a disk that is to become the system disk of another computer. This is briefly described here, but there are some additional caveats as well as shortcuts if you already have a comparable system. To make best use of this, you need an internal or external enclosure in which you can attach a bare hard disk to your computer (otherwise, you would have to temporarily build the new system disk into your existing computer)."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://imranhossain001.github.io/blogs/post/clonearch1/" />







<link rel="stylesheet" href="/blogs/css/style.css" />

<link rel="stylesheet" href="https://imranhossain001.github.io/blogs/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://imranhossain001.github.io/blogs/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="https://imranhossain001.github.io/blogs/img/favicon.png" />


<link href="/blogs/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/blogs/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/blogs/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/blogs/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/blogs/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/blogs/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Wanna clone existing Arch Linux installation ?"/>
<meta name="twitter:description" content="It saves tons of time to clone an existing installation to a new hardware."/>



<meta property="og:title" content="Wanna clone existing Arch Linux installation ?" />
<meta property="og:description" content="It saves tons of time to clone an existing installation to a new hardware." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://imranhossain001.github.io/blogs/post/clonearch1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-06-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-18T00:00:00+00:00" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >cd /home/imran</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blogs/tags/">Tags</a></li>
        
      
        
          <li><a href="/blogs/categories/">Categories</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blogs/tags/">Tags</a></li>
      
    
      
        <li><a href="/blogs/categories/">Categories</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <article class="post">
    <h1 class="post-title">Wanna clone existing Arch Linux installation ?</h1>
    <div class="post-meta">
      
        <time class="post-date">
          2020-06-18
        </time>

        
          
        
      

      
        <span class="post-author"
          >— Written by Imran Hossain</span
        >


      
    </div>

    
      <span class="post-tags">
        
          <a href="https://imranhossain001.github.io/blogs/tags/arch-linux/">#Arch Linux</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>This also works to install Arch on a disk that is to become the system disk of another computer. This is briefly described here, but there are some additional caveats as well as shortcuts if you already have a comparable system. To make best use of this, you need an internal or external enclosure in which you can attach a bare hard disk to your computer (otherwise, you would have to temporarily build the new system disk into your existing computer). This is how I have repeatedly created new Arch Linux installations both at work and at home.</p>
<p>To avoid confusion farther on, let me give names to the three systems involved:</p>
<p>The target system is the installation we are creating
The host system is the one to which the new system disk is attached
The template system is the existing system that is to be cloned
The three systems need not all be different &ndash; for example, the template system could be the same as the host system. The template system may not exist at all, if you want to create a new installation rather than clone one. The host system has to be able to run software on the target system, but otherwise need not be the same CPU architecture &ndash; for example, it may be an x86_64 system when you want to create an i686 system.</p>
<p>I will assume you have already partitioned the target disk and created a file system on the system partition. Then you proceed as follows.</p>
<p>If you have a template system, copy the packages /var/cache/pacman/pkg/* and the databases /var/lib/pacman/sync/* from it to the target disk (after creating the directories).
Extract (with tar) the following packages to the root of the target system in the given order, to get a minimal system to work with:
filesystem
bash gawk grep file glibc ncurses readline sed
acl archlinux-keyring attr bzip2 coreutils curl e2fsprogs expat gcc-libs gnupg gpgme keyutils krb5 libarchive libassuan libgpg-error libgcrypt libidn libssh2 lz4 lzo openssl pacman xz zlib
pacman-mirrorlist tar libcap arch-install-scripts util-linux systemd</p>
<p>This list of packages is copied from the shell script arch-bootstrap.sh linked from the Wiki page, look there for an up-to-date list.
If you do not have a template system, you can run the script arch-bootstrap.sh which downloads the packages above. You have to customise it before running it: Choose your Arch mirror, target root directory and system architecture. The script also tries to perform some of the following steps, but in my experience this never works 100% and has to be postprocessed manually.
Select a mirror in /etc/pacman.d/mirrorlist on the target installation and set the architecture explicitly in /etc/pacman.conf if it is not the same as the host. Pacman refuses to even install packages from the cache when no mirror is selected.
Install the arch-install-scripts package on the host. This contains the arch-chroot script which creates bind mounts for /proc and /dev and others before chroot&rsquo;ing, which saves a lot of hassle. If you host runs a different Linux, you could try downloading the scripts from here, but you may have to make modifications to arch-chroot if it is not completely compatible. This section describes how to do the necessary bind mounts manually. (One should mention that &ndash;rbind mounts are next to impossible to unmount again — try something like grep <!-- raw HTML omitted --> /proc/mounts | awk &lsquo;{ print $2; }&rsquo; | sort -ru | while read m ; umount -n $m ; done or be prepared to reboot.)
arch-chroot into the target system (as root).
Initialise pacman&rsquo;s keyring:
pacman-key &ndash;init
pacman-key &ndash;populate archlinux
Run pacman -S &ndash;force &hellip; to reinstall the packages we unpacked manually above, except for pacman and arch-install-scripts.
Again select your mirror in /etc/pacman.d/mirrorlist as this was overwritten by reinstalling pacman-mirrorlist.
Reinstall the remaining two packages pacman -S &ndash;force pacman arch-install-scripts.
Set the architecture in /etc/pacman.conf again if not the same as the host.
Make a list of the packages installed on the template system:
pacman -Qneq | sort &gt; /root/tmp/explicit-packages
pacman -Qndq | sort &gt; /root/tmp/depend-packages
The list of dependency packages may not be strictly necessary. It helps recreate exactly the same system in case you came to rely on a dependency package that is not needed by an explicitly installed package any more and would therefore not be installed automatically. The sorting is also not necessary, but allows to compare lists with diff between different systems or times.
Install these packages on the target system after transferring the lists to somewhere on the target system:
cat /root/tmp/explicit-packages | pacman -S &ndash;needed -
cat /root/tmp/depend-packages | pacman -S &ndash;needed &ndash;asdeps -
The &ndash;needed prevents reinstallation of packages we installed already. As noted above, installing the dependency packages may be redundant. (The pacman commands above are from the commendable Wiki page &ldquo;pacman tips&rdquo;.)
Copy configuration files from the template system and/or configure /etc/fstab, /etc/hostname, /etc/localtime, /etc/locale.gen, /etc/locale.conf, /etc/vconsole.conf manually as described here.
Install the bootloader, for example by running syslinux-install_update -i -a -m for syslinux (still from the chroot) as described on its Wiki page.
Run mkinitcpio -p linux from the chroot.
&hellip; (More configuration and installation that may be more comfortable from the host system.)
Attach the target system disk to the target hardware.
When booting the new box for the first time, boot into &ldquo;Arch Linux Fallback&rdquo;. mkinitcpio minimises the normal &ldquo;Arch Linux&rdquo; boot to contain only drivers needed for the system on which it is run, i.e. the host system in our case.
Rerun mkinitcpio -p linux on the target system to get a working and fast-booting normal boot option.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://imranhossain001.github.io/blogs/post/archdate/">
                  <span class="button__icon">←</span>
                  <span class="button__text">How to set up time date manually in Arch Linux</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://imranhossain001.github.io/blogs/post/pacman/">
                  <span class="button__text">PACMAN commands</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </article>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >cd /home/imran</span
    >
    <span class="logo__cursor"></span>
  
</a>

			<span>©2023  Imran Hossain <a href="/"><b>Contact me</b></b></a></span>
    
  </div>
</footer>





<script type="text/javascript" src="/blogs/bundle.min.js"></script>


      
    </div>

    
  </body>
</html>
